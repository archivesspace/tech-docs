<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>tech-docs | Technical documentation for ArchivesSpace</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="tech-docs" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Technical documentation for ArchivesSpace" />
<meta property="og:description" content="Technical documentation for ArchivesSpace" />
<meta property="og:site_name" content="tech-docs" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="tech-docs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Technical documentation for ArchivesSpace","headline":"tech-docs","url":"/tech-docs/administration/indexes.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/tech-docs/assets/css/style.css?v=">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/tech-docs/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <style>
  /* Styles via https://getbootstrap.com/docs/5.3/components/alerts/#icons */
  .deprecation-alert {
    display: flex;
    align-items: center;
    padding: 1rem;
    margin-bottom: 1.5rem;
    color: #58151c;
    background-color: #f8d7da;
    border: 1px solid #f1aeb5;
    border-radius: 0.375rem;
  }
  .deprecation-alert__svg {
    flex-shrink: 0 !important;
    width: 1em;
    height: 1em;
    margin-right: 0.5rem !important;
    fill: currentcolor;
  }
</style>

<aside class="deprecation-alert">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    id="exclamation-triangle-fill"
    viewBox="0 0 16 16"
    class="deprecation-alert__svg"
    role="img"
    aria-label="Danger:"
  >
    <path
      d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"
    />
  </svg>

  <p style="margin-bottom: 0">
    <em style="margin-right: 0.25rem; font-weight: 700">NOTE!</em> We recently
    launched a
    <a href="https://docs.archivesspace.org"
      >new technical documentation site</a
    >
    as part of the ArchivesSpace v4.0.0 release.
    <br />
    For now both sites will be live, but we encourage you to take a look at the
    new site and leave feedback or suggestions.
  </p>
</aside>


      <header>
        <h1><a href="/tech-docs/">tech-docs</a></h1>

        

        <p>Technical documentation for ArchivesSpace</p>

        
        <p class="view"><a href="https://github.com/archivesspace/tech-docs">View the Project on GitHub <small>archivesspace/tech-docs</small></a></p>
        

        

        

        <p>
          <a
            href="https://github.com/archivesspace/tech-docs/edit/master/administration/indexes.md"
            title="Edit administration/indexes.md on GitHub"
          >
            Edit this page on GitHub
            <small>administration/indexes.md</small>
          </a>
        </p>

        <p>
          <a
            href="https://archivesspace.atlassian.net/jira/software/projects/TD/issues"
            title="Report issue with administration/indexes.md on Jira"
          >
            Report issue on Jira
            <small>administration/indexes.md</small>
          </a>
        </p>
      </header>
      <section>

      <h1 id="re-creating-indexes">Re-creating indexes</h1>

<p>There are two strategies for reindexing ArchivesSpace:</p>

<ul>
  <li>soft reindex</li>
  <li>full reindex</li>
</ul>

<h2 id="soft-reindex">Soft reindex</h2>

<p>A soft reindex updates the existing documents in Solr without directly
touching the actual index documents on the filesystem. This can be done
while the system is running and is suitable for most use cases.</p>

<p>There are two common ways to perform a soft reindex:</p>

<ol>
  <li>Delete indexer state files</li>
</ol>

<p>ArchivesSpace keeps track of what has been indexed by using the files
under <code class="language-plaintext highlighter-rouge">data/indexer_state</code> and <code class="language-plaintext highlighter-rouge">data/indexer_pui_state</code> (for the PUI).</p>

<p>If these files are missing, the indexer assumes that nothing has been
indexed and reindexes everything. To force ArchivesSpace to reindex all
records, just delete the files in <code class="language-plaintext highlighter-rouge">/path/to/archivesspace/data/indexer_state</code>
and <code class="language-plaintext highlighter-rouge">/path/to/archivesspace/data/indexer_pui_state</code>.</p>

<p>You also can do this selectively by record type, for example, to reindex
accessions in repository 2 delete the file called <code class="language-plaintext highlighter-rouge">2_accession.dat</code>.</p>

<ol>
  <li>Bump <code class="language-plaintext highlighter-rouge">system_mtime</code> values in the database</li>
</ol>

<p>If you update a record’s <code class="language-plaintext highlighter-rouge">system_mtime</code> it becomes eligible for reindexing.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span><span class="k">reindex</span> <span class="k">all</span> <span class="n">resources</span>
<span class="k">UPDATE</span> <span class="n">resource</span> <span class="k">SET</span> <span class="n">system_mtime</span> <span class="o">=</span> <span class="n">NOW</span><span class="p">();</span>
<span class="o">#</span><span class="k">reindex</span> <span class="n">resource</span> <span class="mi">1</span>
<span class="k">UPDATE</span> <span class="n">resource</span> <span class="k">SET</span> <span class="n">system_mtime</span> <span class="o">=</span> <span class="n">NOW</span><span class="p">()</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="full-reindex">Full reindex</h2>

<p>A full reindex is a complete rebuild of the index from the database. This
may be required if you are having indexer issues, in the case of index
corruption, or if called for by an upgrade owing to changes in ArchivesSpace’s
Solr configuration.</p>

<p>To perform a full reindex:</p>

<h3 id="archivesspace--310-embedded-solr">ArchivesSpace &lt;= 3.1.0 (embedded Solr)</h3>

<ul>
  <li>Shutdown ArchivesSpace</li>
  <li>Delete these directories:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">rm -rf /path/to/archivesspace/data/indexer_state/</code></li>
      <li><code class="language-plaintext highlighter-rouge">rm -rf /path/to/archivesspace/data/indexer_pui_state/</code></li>
      <li><code class="language-plaintext highlighter-rouge">rm -rf /path/to/archivesspace/data/solr_index/</code></li>
    </ul>
  </li>
  <li>Restart ArchivesSpace</li>
</ul>

<h3 id="archivesspace--310-external-solr">ArchivesSpace &gt; 3.1.0 (external Solr)</h3>

<p>For external Solr there is a plugin that can perform all of the re-indexing steps: <a href="https://github.com/lyrasis/aspace-reindexer">aspace-reindexer</a></p>

<p>Manual steps:</p>

<ul>
  <li>Shutdown ArchivesSpace</li>
  <li>Delete these directories:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">rm -rf /path/to/archivesspace/data/indexer_state/</code></li>
      <li><code class="language-plaintext highlighter-rouge">rm -rf /path/to/archivesspace/data/indexer_pui_state/</code></li>
    </ul>
  </li>
  <li>Perform a delete all Solr query:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">curl -X POST -H 'Content-Type: application/json' --data-binary '{"delete":{"query":"*:*" }}' http://${solrUrl}:${solrPort}/solr/archivesspace/update?commit=true</code></li>
    </ul>
  </li>
  <li>Restart ArchivesSpace</li>
</ul>

<hr />

<p>You can watch the <a href="https://www.youtube.com/watch?v=yFJ6yAaPa3A">Tips for indexing ArchivesSpace</a> youtube video to see these steps performed.</p>

<hr />


      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/archivesspace">ArchivesSpace</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/tech-docs/assets/js/scale.fix.js"></script>
  </body>
</html>
