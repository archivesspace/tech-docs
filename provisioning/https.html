<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>tech-docs | Technical documentation for ArchivesSpace</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="tech-docs" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Technical documentation for ArchivesSpace" />
<meta property="og:description" content="Technical documentation for ArchivesSpace" />
<meta property="og:site_name" content="tech-docs" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="tech-docs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Technical documentation for ArchivesSpace","headline":"tech-docs","url":"/tech-docs/provisioning/https.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/tech-docs/assets/css/style.css?v=">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/tech-docs/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <style>
  /* Styles via https://getbootstrap.com/docs/5.3/components/alerts/#icons */
  .deprecation-alert {
    display: flex;
    align-items: center;
    padding: 1rem;
    margin-bottom: 1.5rem;
    color: #58151c;
    background-color: #f8d7da;
    border: 1px solid #f1aeb5;
    border-radius: 0.375rem;
  }
  .deprecation-alert__svg {
    flex-shrink: 0 !important;
    width: 1em;
    height: 1em;
    margin-right: 0.5rem !important;
    fill: currentcolor;
  }
</style>

<aside class="deprecation-alert">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    id="exclamation-triangle-fill"
    viewBox="0 0 16 16"
    class="deprecation-alert__svg"
    role="img"
    aria-label="Danger:"
  >
    <path
      d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"
    />
  </svg>

  <p style="margin-bottom: 0">
    <em style="margin-right: 0.25rem; font-weight: 700">NOTE!</em> We recently
    launched a
    <a href="https://docs.archivesspace.org"
      >new technical documentation site</a
    >
    as part of the ArchivesSpace v4.0.0 release.
    <br />
    For now both sites will be live, but we encourage you to take a look at the
    new site and leave feedback or suggestions.
  </p>
</aside>


      <header>
        <h1><a href="/tech-docs/">tech-docs</a></h1>

        

        <p>Technical documentation for ArchivesSpace</p>

        
        <p class="view"><a href="https://github.com/archivesspace/tech-docs">View the Project on GitHub <small>archivesspace/tech-docs</small></a></p>
        

        

        

        <p>
          <a
            href="https://github.com/archivesspace/tech-docs/edit/master/provisioning/https.md"
            title="Edit provisioning/https.md on GitHub"
          >
            Edit this page on GitHub
            <small>provisioning/https.md</small>
          </a>
        </p>

        <p>
          <a
            href="https://archivesspace.atlassian.net/jira/software/projects/TD/issues"
            title="Report issue with provisioning/https.md on Jira"
          >
            Report issue on Jira
            <small>provisioning/https.md</small>
          </a>
        </p>
      </header>
      <section>

      <h1 id="serving-archivesspace-user-facing-applications-over-https">Serving ArchivesSpace user-facing applications over HTTPS</h1>

<p>This document describes the approach for those wishing to install
ArchivesSpace in such a manner that all end-user requests (i.e., URLs)
are served over HTTPS rather than HTTP. For the purposes of this documentation, the URLs for the staff and public interfaces will be:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">https://staff.myarchive.org</code> - staff interface</li>
  <li><code class="language-plaintext highlighter-rouge">https://public.myarchive.org</code> - public interface</li>
</ul>

<p>The configuration described in this document is one possible approach,
and to keep things simple the following are assumed:</p>

<ul>
  <li>ArchivesSpace is running on a single Linux server</li>
  <li>The server is running Apache or Nginx</li>
  <li>You have obtained an SSL certificate and key from an authority</li>
  <li>You have ensured that appropriate firewall ports have been opened (80 and 443).</li>
</ul>

<ol>
  <li><a href="#Step-1%3A-Configure-Web-Server-(Apache-or-Nginx)">Configuring the Web Server</a>
    <ul>
      <li><a href="#Apache">Apache</a>
        <ul>
          <li><a href="#Setting-up-SSL">Setting up SSL</a></li>
          <li><a href="#Setting-up-Redirects">Setting up Redirects</a></li>
        </ul>
      </li>
      <li><a href="#Nginx">Nginx</a></li>
    </ul>
  </li>
  <li><a href="#Step-2%3A-Configure-ArchivesSpace">Configuring ArchivesSpace</a></li>
</ol>

<h2 id="step-1-configure-web-server-apache-or-nginx">Step 1: Configure Web Server (Apache or Nginx)</h2>

<h3 id="apache">Apache</h3>
<p>Information about configuring Apache for SSL can be found at http://httpd.apache.org/docs/current/ssl/ssl_howto.html.  You should read
that documentation before attempting to configure SSL.</p>

<h4 id="setting-up-ssl">Setting up SSL</h4>

<p>Use the <code class="language-plaintext highlighter-rouge">NameVirtualHost</code> and <code class="language-plaintext highlighter-rouge">VirtualHost</code> directives to proxy
requests to the actual application urls. This requires the use of the <code class="language-plaintext highlighter-rouge">mod_proxy</code> module in Apache.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> NameVirtualHost *:443

 &lt;VirtualHost *:443&gt;
   ServerName staff.myarchive.org
   SSLEngine On
   SSLCertificateFile "/path/to/your/cert.crt"
   SSLCertificateKeyFile "/path/to/your/key.key"
   RequestHeader set X-Forwarded-Proto "https"
   ProxyPreserveHost On
   ProxyPass / http://localhost:8080/
   ProxyPassReverse / http://localhost:8080/
 &lt;/VirtualHost&gt;

 &lt;VirtualHost *:443&gt;
   ServerName public.myarchive.org
   SSLEngine On
   SSLCertificateFile "/path/to/your/cert.crt"
   SSLCertificateKeyFile "/path/to/your/key.key"
   RequestHeader set X-Forwarded-Proto "https"
   ProxyPreserveHost On
   ProxyPass / http://localhost:8081/
   ProxyPassReverse / http://localhost:8081/
 &lt;/VirtualHost&gt;
</code></pre></div></div>

<p>You may optionally set the <code class="language-plaintext highlighter-rouge">Set-Cookie: Secure attribute</code> by adding <code class="language-plaintext highlighter-rouge">Header edit Set-Cookie ^(.*)$ $1;HttpOnly;Secure</code>. When a cookie has the Secure attribute, the user agent will include the cookie in an HTTP request only if the request is transmitted over a secure channel.</p>

<p>Users may encounter a warning in the browser’s console stating <code class="language-plaintext highlighter-rouge">Cookie “archivesspace_session” does not have a proper “SameSite” attribute value. Soon, cookies without the “SameSite” attribute or with an invalid value will be treated as “Lax”. This means that the cookie will no longer be sent in third-party contexts</code> (example from Firefox 104) or something similar. Some browsers (for example, Chrome version 80 or above) already enforce this. Standard ArchivesSpace installations should be unaffected, but if you encounter problems with integrations and/or customizations of your particular installation, the following directive may be required: <code class="language-plaintext highlighter-rouge">Header edit Set-Cookie ^(.*)$ $1;SameSite=None;Secure</code>. Alternatively, it may be the case that <code class="language-plaintext highlighter-rouge">SameSite=Lax</code> (the default) or even <code class="language-plaintext highlighter-rouge">SameSite=Strict</code> are more appropriate depending on your functional and/or security requirements. Please refer to https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite or other resources for more information.</p>

<h4 id="setting-up-redirects">Setting up Redirects</h4>
<p>When running a site over HTTPS, it’s a good idea to set up a redirect to ensure any outdated HTTP requests are routed to the correct URL. This can be done through Apache as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;VirtualHost *:80&gt;
ServerName staff.myarchive.org
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule (.*) https://staff.myarchive.org$1 [R,L]
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
ServerName public.myarchive.org
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule (.*) https://public.myarchive.org$1 [R,L]
&lt;/VirtualHost&gt;
</code></pre></div></div>

<h3 id="nginx">Nginx</h3>

<p>Information about configuring nginx for SSL can be found at http://nginx.org/en/docs/http/configuring_https_servers.html  You should read
that documentation before attempting to configure SSL.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
server {
	listen 80;
	listen [::]:80;
	server_name staff.myarchive.org;
	return 301 https://staff.myarchive.org;
}


server {
  listen 443 ssl;
  server_name staff.myarchive.org;
  charset utf-8;
  }
 
  ssl_certificate     /path/to/your/fullchain.pem;
  ssl_certificate_key /path/to/your/key.pem

  location / {
    allow 0.0.0.0/0;
    deny all;
    proxy_pass http://localhost:8081;
  }
}

server {
	listen 80;
	listen [::]:80;
	server_name public.myarchive.org;
	return 301 https://public.myarchive.org;
}


server {
  listen 443 ssl;
  server_name staff.myarchive.org;
  charset utf-8;
  }
 
  ssl_certificate     /path/to/your/fullchain.pem;
  ssl_certificate_key /path/to/your/key.pem

  location / {
    allow 0.0.0.0/0;
    deny all;
    proxy_pass http://localhost:8080;
  }
}

</code></pre></div></div>

<h2 id="step-2-configure-archivesspace">Step 2: Configure ArchivesSpace</h2>

<p>The following lines need to be altered in the config.rb file:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AppConfig[:frontend_proxy_url] = "https://staff.myarchive.org"
AppConfig[:public_proxy_url] = "https://public.myarchive.org"
</code></pre></div></div>
<p>These lines don’t need to be altered and should remain with their default values. E.g.:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AppConfig[:frontend_url] = "http://localhost:8080"
AppConfig[:public_url] = "http://localhost:8081"
AppConfig[:frontend_proxy_prefix] = proc { "#{URI(AppConfig[:frontend_proxy_url]).path}/".gsub(%r{/+$}, "/") }
AppConfig[:public_proxy_prefix] = proc { "#{URI(AppConfig[:public_proxy_url]).path}/".gsub(%r{/+$}, "/") }
</code></pre></div></div>


      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/archivesspace">ArchivesSpace</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/tech-docs/assets/js/scale.fix.js"></script>
  </body>
</html>
