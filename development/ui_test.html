<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>tech-docs | Technical documentation for ArchivesSpace</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="tech-docs" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Technical documentation for ArchivesSpace" />
<meta property="og:description" content="Technical documentation for ArchivesSpace" />
<meta property="og:site_name" content="tech-docs" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="tech-docs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Technical documentation for ArchivesSpace","headline":"tech-docs","url":"/tech-docs/development/ui_test.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/tech-docs/assets/css/style.css?v=">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/tech-docs/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <style>
  /* Styles via https://getbootstrap.com/docs/5.3/components/alerts/#icons */
  .deprecation-alert {
    display: flex;
    align-items: center;
    padding: 1rem;
    margin-bottom: 1.5rem;
    color: #58151c;
    background-color: #f8d7da;
    border: 1px solid #f1aeb5;
    border-radius: 0.375rem;
  }
  .deprecation-alert__svg {
    flex-shrink: 0 !important;
    width: 1em;
    height: 1em;
    margin-right: 0.5rem !important;
    fill: currentcolor;
  }
</style>

<aside class="deprecation-alert">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    id="exclamation-triangle-fill"
    viewBox="0 0 16 16"
    class="deprecation-alert__svg"
    role="img"
    aria-label="Danger:"
  >
    <path
      d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"
    />
  </svg>

  <p style="margin-bottom: 0">
    <em style="margin-right: 0.25rem; font-weight: 700">NOTE!</em> We recently
    launched a
    <a href="https://docs.archivesspace.org"
      >new technical documentation site</a
    >
    as part of the ArchivesSpace v4.0.0 release.
    <br />
    For now both sites will be live, but we encourage you to take a look at the
    new site and leave feedback or suggestions.
  </p>
</aside>


      <header>
        <h1><a href="/tech-docs/">tech-docs</a></h1>

        

        <p>Technical documentation for ArchivesSpace</p>

        
        <p class="view"><a href="https://github.com/archivesspace/tech-docs">View the Project on GitHub <small>archivesspace/tech-docs</small></a></p>
        

        

        

        <p>
          <a
            href="https://github.com/archivesspace/tech-docs/edit/master/development/ui_test.md"
            title="Edit development/ui_test.md on GitHub"
          >
            Edit this page on GitHub
            <small>development/ui_test.md</small>
          </a>
        </p>

        <p>
          <a
            href="https://archivesspace.atlassian.net/jira/software/projects/TD/issues"
            title="Report issue with development/ui_test.md on Jira"
          >
            Report issue on Jira
            <small>development/ui_test.md</small>
          </a>
        </p>
      </header>
      <section>

      <h1 id="ui-test-suites">UI test suites</h1>

<p>ArchivesSpaceâ€™s staff and public interfaces use <a href="http://docs.seleniumhq.org/">Selenium</a> to run automated browser tests. These tests can be run using <a href="https://firefox-source-docs.mozilla.org/testing/geckodriver/geckodriver/index.html">Firefox via geckodriver</a> and <a href="https://sites.google.com/a/chromium.org/chromedriver/home">Chrome</a> (either regular Chrome or headless).</p>

<p>Firefox is the default used in our <a href="https://github.com/archivesspace/archivesspace/actions">CI workflows</a>.</p>

<p>On Ubuntu 22.04 or later, the included Firefox deb package is a transition package that actually installs Firefox through <a href="https://snapcraft.io/">snap</a>. Snap has security restrictions that do not work with automated testing without additional configuration.</p>

<p>To uninstall the Firefox snap package and reinstall it as a traditional deb package on Ubuntu use:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># remove old snap firefox package (if installed)</span>
<span class="nb">sudo </span>snap remove firefox

<span class="c"># create a keyring directory (if not existing)</span>
<span class="nb">sudo install</span> <span class="nt">-d</span> <span class="nt">-m</span> 0755 /etc/apt/keyrings

<span class="c"># download mozilla key and add it to the keyring</span>
wget <span class="nt">-q</span> https://packages.mozilla.org/apt/repo-signing-key.gpg <span class="nt">-O-</span> | <span class="nb">sudo tee</span> /etc/apt/keyrings/packages.mozilla.org.asc <span class="o">&gt;</span> /dev/null

<span class="c"># set high priority for the mozilla pakcages</span>
<span class="nb">echo</span> <span class="s2">"deb [signed-by=/etc/apt/keyrings/packages.mozilla.org.asc] https://packages.mozilla.org/apt mozilla main"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/apt/sources.list.d/mozilla.list <span class="o">&gt;</span> /dev/null
<span class="nb">echo</span> <span class="s1">'
Package: *
Pin: origin packages.mozilla.org
Pin-Priority: 1000
'</span> | <span class="nb">sudo tee</span> /etc/apt/preferences.d/mozilla

<span class="c"># install firefox and geckdriver as a standard deb package</span>
<span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt <span class="nb">install </span>firefox firefox-geckodriver
</code></pre></div></div>

<p>On Mac you can use: <code class="language-plaintext highlighter-rouge">brew install geckodriver</code>.</p>

<p>To run using Chrome, you must first download the appropriate <a href="https://sites.google.com/a/chromium.org/chromedriver/downloads">ChromeDriver
executable</a>
and place it somewhere in your OS system path.  Mac users with Homebrew may accomplish this via <code class="language-plaintext highlighter-rouge">brew cask install chromedriver</code>.</p>

<p><strong>Please note, you must have either Firefox or Chrome installed on your system to
run these tests. Consult the <a href="https://developer.mozilla.org/en-US/docs/Web/WebDriver">Firefox WebDriver</a>
or <a href="https://sites.google.com/a/chromium.org/chromedriver/home">ChromeDriver</a>
documentation to ensure your Selenium, driver, browser, and OS versions all match
and support each other.</strong></p>

<h2 id="before-running">Before running:</h2>

<p>Run the bootstrap build task to configure JRuby and all required dependencies:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ cd ..
 $ build/run bootstrap
</code></pre></div></div>

<p>Note: all example code assumes you are running from your ArchivesSpace project directory.</p>

<h2 id="running-the-tests">Running the tests:</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Frontend tests</span>
./build/run frontend:selenium <span class="c"># Firefox, headless</span>
<span class="nv">FIREFOX_OPTS</span><span class="o">=</span> ./build/run frontend:selenium <span class="c"># Firefox, no-opts = heady</span>

<span class="nv">SELENIUM_CHROME</span><span class="o">=</span><span class="nb">true</span> ./build/run frontend:selenium <span class="c"># Chrome, headless</span>
<span class="nv">SELENIUM_CHROME</span><span class="o">=</span><span class="nb">true </span><span class="nv">CHROME_OPTS</span><span class="o">=</span> ./build/run frontend:selenium <span class="c"># Chrome, no-opts = heady</span>

<span class="c">#Public tests</span>
./build/run public:test <span class="c"># Firefox, headless</span>
<span class="nv">FIREFOX_OPTS</span><span class="o">=</span> ./build/run public:test <span class="c"># Firefox, no-opts = heady</span>

<span class="nv">SELENIUM_CHROME</span><span class="o">=</span><span class="nb">true</span> ./build/run public:test <span class="c"># Chrome, headless</span>
<span class="nv">SELENIUM_CHROME</span><span class="o">=</span><span class="nb">true </span><span class="nv">CHROME_OPTS</span><span class="o">=</span> ./build/run public:test <span class="c"># Chrome, no-opts = heady</span>
</code></pre></div></div>

<p>Tests can be scoped to specific files or groups:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build/run .. <span class="nt">-Dspec</span><span class="o">=</span><span class="s1">'path/to/spec/from/spec/directory'</span> <span class="c"># single file</span>
./build/run .. <span class="nt">-Dexample</span><span class="o">=</span><span class="s1">'[description from it block]'</span> <span class="c"># specific block</span>

<span class="c">#EXAMPLES</span>
./build/run frontend:selenium <span class="nt">-Dexample</span><span class="o">=</span><span class="s1">'Repository model'</span>
<span class="nv">FIREFOX_OPTS</span><span class="o">=</span> ./build/run frontend:selenium <span class="nt">-Dexample</span><span class="o">=</span><span class="s1">'Repository model'</span><span class="c"># Firefox, heady</span>

./build/run public:test <span class="nt">-Dspec</span><span class="o">=</span><span class="s1">'features/accessibility_spec.rb'</span>
<span class="nv">SELENIUM_CHROME</span><span class="o">=</span><span class="nb">true </span><span class="nv">CHROME_OPTS</span><span class="o">=</span> ./build/run public:test <span class="nt">-Dspec</span><span class="o">=</span><span class="s1">'features/accessibility_spec.rb'</span> <span class="c"># Chrome, heady</span>
</code></pre></div></div>

<p>Test require a backend and a frontend service to be running. To ovoid the overhead of starting and stopping them while developing, you can run tests against a dev backend:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># start mysql and solr containers:
docker-compose -f docker-compose-dev.yml up

# start services:
 supervisord -c supervisord/archivesspace.conf

# run a spec using the started backend:
ASPACE_TEST_BACKEND_URL='http://localhost:4567' ./build/run frontend:test -Dpattern="./features/events_spec.rb"

# run all examples that contain "can spawn" in their description:
./build/run frontend:test -Dpattern="./features/accessions_spec.rb" -Dexample="can spawn"
</code></pre></div></div>

<p>Note, however, that some tests are dependent on a sequence of ordered steps and may not always run cleanly in isolation.  In this case, more than the example provided may be run, and/or unexpected fails may result.</p>

<h3 id="saved-pages-on-spec-failures">Saved pages on spec failures</h3>
<p>When frontend specs fail, a screenshot and an html page is saved for each failed example under <code class="language-plaintext highlighter-rouge">frontend/tmp/capybara</code>. On the CI, a zip file will be available for each failed CI job run under Summary -&gt; Artifacts. In order to load the assets (and not see plain html) when viewing the saved html pages, a dev server should be running locally on port 3000, see [Running a development version of ArchivesSpace(https://archivesspace.github.io/tech-docs/development/dev.html).</p>

<h3 id="keeping-the-test-database-up-to-date">Keeping the test database up to date</h3>
<p>When calling <code class="language-plaintext highlighter-rouge">./build/run frontend:test</code> to run frontend specs, the following steps happen before the actual specs run:</p>

<ul>
  <li>All tables of the test database are dropped: <code class="language-plaintext highlighter-rouge">./build/run db:nuke:test</code></li>
  <li><code class="language-plaintext highlighter-rouge">frontend/spec/fixtures/archivesspace-test.sql</code> is loaded to the test database: <code class="language-plaintext highlighter-rouge">./build/run db:load:test</code></li>
  <li>Any not-yet-applied migrations are run: <code class="language-plaintext highlighter-rouge">./build/run db:migrate:test</code></li>
</ul>

<h4 id="updating-the-test-database-dump">Updating the test database dump</h4>
<p>If any migrations are being applied whenever you run one or all frontend specs, it means that the test database dump <code class="language-plaintext highlighter-rouge">frontend/spec/fixtures/archivesspace-test.sql</code> has stayed behind. A new test database dump can be created by running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build/run db:nuke:test
./build/run db:load:test
./build/run db:migrate:test
./build/run db:dump:test
</code></pre></div></div>

<p>An updated <code class="language-plaintext highlighter-rouge">frontend/spec/fixtures/archivesspace-test.sql</code> will be created that can be committed and pushed to a Pull Request.</p>


      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/archivesspace">ArchivesSpace</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/tech-docs/assets/js/scale.fix.js"></script>
  </body>
</html>
